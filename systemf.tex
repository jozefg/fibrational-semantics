\section{Semantics for System F}

Let us start with a simple definition of System F. To be more explicit
than usual, let us start by noting the three core judgments of the
system.
\[
  \ctxJ{\Delta}{\Gamma} \qquad \typeJ{\Delta}{\tau} \qquad \hastypeJ{\Delta}{\Gamma}{e}{\tau}
\]
The judgment for $\ctxJ{\Delta}{\Gamma}$ is a simple extension of the
typehood judgment.
\begin{mathpar}
  \inferrule{ }{\ctxJ{\Delta}{\cdot}} \and
  \inferrule{
    \ctxJ{\Delta}{\Gamma}\\
    \typeJ{\Delta}{\tau}
  }{\ctxJ{\Delta}{\Gamma, x : \tau}}\and
  \inferrule{
    \typeJ{\Delta, \alpha}{\tau}
  }{\typeJ{\Delta}{\all{\alpha}{\tau}}}\and
  \inferrule{
    \typeJ{\Delta}{\tau_1}\\
    \typeJ{\Delta}{\tau_2}
  }{\typeJ{\Delta}{\tau_1 \to \tau_2}}\and
  \inferrule{
    \alpha \in \Delta
  }{\typeJ{\Delta}{\alpha}}\and
\end{mathpar}

Next we have the usual typing rules for terms. One will observe that I
deviate from some presentations of System F by using two contexts to
represent types \emph{and} terms rather than blending them into one
context. This is a nod towards the semantics where such things will be
fundamentally separated anyways, with one living in the base category
and one living in the fibers above it.

\begin{mathpar}
  \inferrule{
    x : \tau \in \Gamma
  }{\hastypeJ{\Delta}{\Gamma}{x}{\tau}}\and
  \inferrule{
    \hastypeJ{\Delta}{\Gamma, x : \tau_1}{e}{\tau_2}
  }{\hastypeJ{\Delta}{\Gamma}{\lam{x}{\tau}{e}}{\tau_1 \to \tau_2}}\and
  \inferrule{
    \hastypeJ{\Delta}{\Gamma}{e_1}{\tau_1 \to \tau_2}\\
    \hastypeJ{\Delta}{\Gamma}{e_2}{\tau_1}
  }{\hastypeJ{\Delta}{\Gamma}{\ap{e_1}{e_2}}{\tau_2}}\and
  \inferrule{
    \hastypeJ{\Delta, \alpha}{\Gamma}{e}{\tau}
  }{\hastypeJ{\Delta}{\Gamma}{\Lam{x}{e}}{\all{\alpha}{\tau}}}\and
  \inferrule{
    \hastypeJ{\Delta}{\Gamma}{e}{\all{\alpha}{\tau_1}}\\
    \typeJ{\Delta}{\tau_2}
  }{\hastypeJ{\Delta}{\Gamma}{\Ap{e}{\tau_2}}{[\tau_2/\alpha]\tau_1}}\and
\end{mathpar}

Having fleshed out the objects of our language we now turn to the
semantics of our language. They will proceed in three parts. First we
isolate the specific variety of fibration that we will be
studying. Second we will denote the terms and contexts into objects in
base category. Finally, we will denote terms into morphisms in the
fibers above contexts. Put briefly
\begin{description}
\item[Type contexts] objects in the base category.
\item[Types] morphisms in the base category into the generic object
  from the type context. Equivalently, objects in the fiber above the
  type context.
\item[Term Contexts] objects in the fiber above a type context.
\item[Terms] morphisms between term contexts. Equivalently, vertical
  morphisms in the fiber above the type context.
\end{description}

With this plan in mind, we are in a position to define what structure
we will need for our fibration.
\begin{defn}\label{defn:systemf:polymorphicfibration}
  A polymorphic fibration, $p : \Ecat \to \Bcat$ is a fibration with
  \begin{enumerate}
  \item Fiberwise finite products and exponentials.
  \item Finite products in the base category.
  \item A generic object $T$.
  \item Right adjoints to the reindexing functors for projections.
  \end{enumerate}
\end{defn}
For now we will set aside the question of what fibrations exist which
satisfy these constraints and focus instead show that this is
sufficient to model System F. First, we present the denotation of
type context.
\begin{align*}
  \denote{\cdot} &= 1\\
  \denote{\Delta, \alpha} &= \denote{\Delta} \times p(T)
\end{align*}
This is just the straightforward mapping based on the insight that
maps into $p(T)$ will classify types via transposition. That is, we
know that there is a bijection
$\phi_I : \hom(I, p(T)) \cong \obj(\Ecat_I)$.  Next comes the denotation
of types.
\begin{align*}
  \denote{\typeJ{\Delta}{\alpha}} &= \pi_{\alpha}\\
  \denote{\typeJ{\Delta}{\tau_1 \to \tau_2}} &=
  \phi^{-1}\left(\phi(\denote{\typeJ{\Delta}{\tau_2}})^{\phi(\denote{\typeJ{\Delta}{\tau_1}})}\right)\\
  \denote{\typeJ{\Delta}{\all{\alpha}{\tau}}} &=
  \phi^{-1}\left(\Pi_{\pi}\phi(\denote{\typeJ{\Delta, \alpha}{\tau_1}})\right)
\end{align*}
Here $\pi_{\alpha}$ is the projection extraction $\alpha \in \Delta$
from the product $\denote{\Delta}$. Notice the use of $\phi$ to make
use of the structure that we have at the level of fibers in the base
category. This ability to tie together the base and total category is
a common usage of generic objects.

Now under $\phi$, we know that the denotation
$\denote{\typeJ{\Delta}{A}}$ corresponds to an object in the fiber
above $\denote{\Delta}$. Using this, we shall denote terms
$\hastypeJ{\Delta}{\Gamma}{e}{\tau}$ into morphisms in
\[
  \hom_{\Ecat_{\denote{\Delta}}}(\denote{\ctxJ{\Delta}{\Gamma}}, \phi(\denote{\typeJ{\Delta}{A}}))
\]
This is defined, as is standard, by induction on the typing
derivation. In order to do this, let us shall write $\psi_A$ for the
natural bijection $\hom(\pi^*(A), B) \cong \hom(A, \Pi B)$
\begin{align*}
  \denote{\hastypeJ{\Delta}{\Gamma}{x}{\tau}} &= \pi_x\\
  \denote{\hastypeJ{\Delta}{\Gamma}{\lam{x}{\tau_1}{e}}{\tau_1 \to \tau_2}} &=
  \Lambda(\denote{\hastypeJ{\Delta}{\Gamma, x : \tau_1}{e}{\tau_2}})\\
  \denote{\hastypeJ{\Delta}{\Gamma}{\ap{e_1}{e_2}}{\tau_2}} &=
  \ev \circ
  \langle \denote{\hastypeJ{\Delta}{\Gamma}{e_1}{\tau_1 \to \tau_2}}, \denote{\hastypeJ{\Delta}{\Gamma}{e_1}{\tau_1 \to \tau_2}} \rangle\\
  \denote{\hastypeJ{\Delta}{\Gamma}{\Lam{\alpha}{e}}{\all{\alpha}{\tau}}} &=
  \psi(\denote{\hastypeJ{\Delta, \alpha}{\Gamma}{e}{\tau}})\\
  \denote{\hastypeJ{\Delta}{\Gamma}{\Ap{e}{\tau_1}}{[\tau_1/\alpha]\tau_2}} &=
  \langle 1, \denote{\typeJ{\Delta}{\tau_1}}\rangle^*(\denote{\hastypeJ{\Delta, \alpha}{\Gamma}{e}{\all{\alpha}{\tau_2}}})
\end{align*}
